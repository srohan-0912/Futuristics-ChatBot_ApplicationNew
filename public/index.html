<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Futuristic Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>
  <div class="container">
    <div class="users">
      <h2>ğŸŸ¢ Online</h2>
      <ul id="userList"></ul>
    </div>

    <div class="chat">
      <h1>
        Chat - <span id="displayName"></span>
        <button onclick="editName()">âœï¸</button>
        <button id="themeToggle">ğŸŒ™</button>
        <img id="avatarPreview" class="avatar-preview" style="display:none;width:36px;height:36px;border-radius:50%;margin-left:8px;" />
      </h1>

      <ul id="messages"></ul>

      <div id="typingIndicator"></div>

      <div class="input-area">
        <input id="messageInput" placeholder="Type your message..." />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

<script>
const socket = io();

let username = localStorage.getItem("username") || prompt("Enter your name");
document.getElementById("displayName").textContent = username;
socket.emit("new user", { username, avatar: "" });

const messages = document.getElementById("messages");
const input = document.getElementById("messageInput");

document.getElementById("sendBtn").onclick = sendMessage;
input.addEventListener("keydown", e => e.key === "Enter" && sendMessage());

function sendMessage() {
  if (input.value.trim()) {
    socket.emit("chat message", { text: input.value });
    input.value = "";
  }
}

socket.on("chat message", msg => {
  const li = document.createElement("li");
  li.innerHTML = `<strong>${msg.username}:</strong> ${msg.text}`;
  messages.appendChild(li);
  li.scrollIntoView();
});

socket.on("system message", msg => {
  const li = document.createElement("li");
  li.style.color = "cyan";
  li.textContent = msg;
  messages.appendChild(li);
});

socket.on("user list", users => {
  const ul = document.getElementById("userList");
  ul.innerHTML = "";
  users.forEach(u => {
    const li = document.createElement("li");
    li.textContent = u.username;
    ul.appendChild(li);
  });
});
</script>
</body>
</html>
